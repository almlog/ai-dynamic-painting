# Claude用プロジェクト設定 - AI動的絵画システム

## 起動時に読み込むファイル
このプロジェクトで作業する際は、まず以下のファイルを確認してください：

1. **企画書.md** - プロジェクト企画・価値提案
   - プロジェクト目的・背景
   - 期待効果・成功指標
   - コスト・投資計画

2. **詳細設計書.md** - システム詳細設計
   - システムアーキテクチャ
   - ハードウェア・ソフトウェア仕様
   - API・データベース設計
   - セキュリティ・運用設計

3. **実装計画書.md** - 段階的実装計画
   - Phase 1: 基盤システム構築
   - Phase 2: AI統合・自動化
   - Phase 3: 高度機能・運用最適化

4. **PERSONA.md** - 開発者ペルソナ（作成推奨）
   - モダンWebアプリ開発エキスパート
   - Python/FastAPI + React/TypeScript
   - IoT・エッジAI統合
   - 段階的品質向上の開発哲学

## AI動的絵画システム開発スタイル
このプロジェクトでは「**AIエージェント主導・段階的実装開発（AI-Driven Incremental Development）**」を採用します。

### 開発フロー
1. **フェーズ分析** → 現在のフェーズ確認・目標設定
2. **実装設計** → モジュール単位の詳細設計
3. **ハードウェア確認** → 物理デバイス・センサー動作確認
4. **段階実装** → MVP → 機能拡張 → 統合テスト
5. **デプロイ・検証** → 実環境動作確認・次フェーズ準備

### プロジェクト構成
```
ai_painting_system/
├── docs/                    # プロジェクトドキュメント
│   ├── 企画書.md
│   ├── 詳細設計書.md
│   ├── 実装計画書.md
│   └── claude.md           # このファイル
├── phase_status/           # フェーズ進捗管理
│   ├── phase1_progress.md
│   ├── phase2_progress.md
│   └── phase3_progress.md
├── core/                   # コアシステム
├── api/                    # API統合層
├── web/                    # Web UI
├── m5stack/               # M5STACKプログラム
├── database/              # データ管理
├── tests/                 # テストスイート
└── deployment/            # デプロイメント
```

## コーディング規約（IoT・AI統合開発）
- **言語**: Python 3.11+（メイン）、C++（M5STACK）、HTML/CSS/JS（Web UI）
- **スタイル**: PEP 8準拠、型ヒント必須
- **設定管理**: ハードコーディング禁止、環境変数・設定ファイル活用
- **ログ**: 構造化ログ（JSON）、レベル分け、ローテーション対応
- **エラーハンドリング**: 多層フォールバック、自動復旧機能
- **ドキュメント**: Google Style docstring、API仕様書自動生成

## TDD + ハードウェア統合テスト原則 - 必須遵守
### Red-Green-Refactor + Hardware サイクルの厳守
1. **Red**: 失敗するテストを最初に書く（ユニット・統合・ハードウェア）
2. **Green**: テストを通すための最小限のコードを書く
3. **Hardware**: 実際のハードウェアで動作確認
4. **Refactor**: テストが通る状態を保ちながらコード改善

### 完成の定義（段階的）
#### Phase 1 完成基準
- [ ] 手動動画アップロード・表示が Raspberry Pi + モニターで動作
- [ ] Web UI で動画管理が PC・スマホから操作可能
- [ ] M5STACK でボタン操作・センサー読み取りが正常動作
- [ ] 24時間連続稼働で安定動作（メモリリーク・クラッシュなし）
- [ ] 全自動テストがパス + 手動確認完了

#### Phase 2 完成基準
- [ ] VEO API で動画が正常生成・保存される
- [ ] 時間・天気・季節に基づく自動プロンプト生成が動作
- [ ] スケジュール通りに動画が自動生成される
- [ ] コンテキストに応じた最適動画選択が動作
- [ ] API クォータ・コスト管理が正常動作

#### Phase 3 完成基準
- [ ] 個人の好み学習・反映が動作
- [ ] 自動監視・バックアップ・障害対応が動作
- [ ] 長期運用（3ヶ月）で安定稼働
- [ ] 拡張機能（音声認識等）が動作
- [ ] 企画書の全要件達成

### 禁止事項
- ❌ ハードウェア確認なしでの「完成」宣言
- ❌ モックテストのみでの次フェーズ移行
- ❌ API エラーが出ている状態での継続
- ❌ 「開発環境で動いてるから大丈夫」思考
- ❌ M5STACK・Raspberry Pi実機確認の省略

### 必須の確認プロセス
#### ソフトウェア確認
1. **自動テスト実行**: `python -m pytest tests/ -v --cov=core`
2. **静的解析**: `flake8 .`, `mypy .`, `bandit -r .`
3. **APIテスト**: `curl` または Postman でエンドポイント確認
4. **Web UI確認**: ブラウザでの手動操作確認

#### ハードウェア統合確認
1. **Raspberry Pi**: SSH接続・ディスプレイ出力・動画再生確認
2. **M5STACK**: WiFi接続・センサー値・ボタン応答確認
3. **通信確認**: M5STACK ↔ Raspberry Pi HTTP通信確認
4. **エンドツーエンド**: センサー入力 → 判定 → 動画表示の全フロー

#### API・外部サービス確認
1. **VEO API**: 実際の動画生成・ダウンロード確認
2. **天気API**: リアルタイム天気データ取得確認
3. **コスト確認**: API使用量・料金の監視確認
4. **障害対応**: ネットワーク断・API制限時の動作確認

## フェーズ別開発アプローチ
### Phase 1: 基盤システム（安定性重視）
- **目標**: 手動管理で完全動作するシステム
- **重点**: 基本機能・安定性・ユーザビリティ
- **完成まで**: 他フェーズに移行しない

### Phase 2: AI統合（自動化重視）
- **目標**: VEO API統合・自動プロンプト生成
- **重点**: API統合・自動化・スケジューリング
- **完成まで**: Phase 3に移行しない

### Phase 3: 高度機能（最適化重視）
- **目標**: 学習・運用自動化・拡張機能
- **重点**: 個人化・運用効率・長期安定性

## 重要な開発方針
### AIエージェント主導開発の特徴
- **継続的改善**: 完璧な初期実装より動作するものから段階拡張
- **実験的アプローチ**: 失敗を恐れず迅速な試行錯誤と改善
- **モジュール設計**: 独立性の高いコンポーネントで変更リスク最小化
- **ドキュメント駆動**: 明確な仕様書に基づく実装で品質確保

### エラー・例外対応方針
- **障害許容設計**: 一部機能停止でもシステム全体は継続動作
- **多層フォールバック**: API失敗時のキャッシュ・代替機能
- **自動復旧**: 可能な限り人手を介さない障害回復
- **手動対応**: 複雑な障害は手動対応を前提とした設計

### ユーザビリティ最優先
- **技術的完璧性 < 日常使用の便利さ**: 実用性を最重視
- **シンプル操作**: M5STACKボタン・Web UI直感的操作
- **状態可視化**: システム状況の分かりやすい表示
- **メンテナンス簡素化**: 複雑な保守作業の回避

## 現在のプロジェクト状況
### 完了済み
- ✅ 企画書作成・承認
- ✅ 詳細設計書作成  
- ✅ 実装計画書作成
- ✅ 技術選定・アーキテクチャ確定

### 次のアクション
- 🔄 **現在**: Phase 1実装準備
- 📋 **すぐやること**: 
  1. ハードウェア準備（Raspberry Pi・M5STACK・モニター）
  2. 開発環境構築
  3. Phase 1実装開始

## 注意事項・開発原則
- **段階的実装**: 各フェーズ完成まで次に移行しない
- **実機確認**: 全てのハードウェアで実際の動作確認必須
- **ドキュメント更新**: 設計変更時は関連ドキュメント同時更新
- **コスト意識**: VEO API使用量・電気代等の運用コスト常時監視
- **オープン設計**: 将来的な機能追加・カスタマイズを考慮した拡張可能設計

---

**このプロジェクトは「実用的で美しい、家庭で毎日使えるAI動的絵画システム」の実現を目指します。**

技術的な完璧性よりも、日常使用での満足度・安定性・拡張性を重視して開発を進めてください。