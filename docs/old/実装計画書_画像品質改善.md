# 実装計画書: AI画像品質向上機能

## 1. 開発方針
本プロジェクトは、バックエンドのAPI機能拡張を先行して行い、その後フロントエンドのUIを実装する「バックエンド先行開発」アプローチを採用する。各ステップでテストを作成・実行する「テスト駆動開発（TDD）」を遵守し、機能の品質と安定性を確保する。

- **開発スタイル:** Gemini（司令塔）がタスクを定義し、Claude（実装者）がコーディングを行う。
- **リポジトリブランチ戦略:** `feature/image-quality-improvement` ブランチを作成し、そこで開発を行う（推奨）。

## 2. タスク一覧 (Work Breakdown Structure)

### フェーズ1: バックエンド機能拡張 (担当: Claude, 期間: 1営業日)

**目的:** AI画像生成サービスとAPIが、詳細な生成パラメータを受け取れるようにする。

| タスクID | タスク名 | 詳細 | 成果物 | テスト |
|:---|:---|:---|:---|:---|
| **T-IQ-01** | `GeminiService`の拡張 | `backend/src/services/gemini_service.py` の `generate_image` メソッドを修正。`prompt` に加え、`quality`, `aspect_ratio`, `negative_prompt`, `style`, `seed` 等の引数を追加し、Imagen 2 APIへのリクエストに含める。 | `generate_image` メソッドのシグネチャとロジックが更新されている。 | `test_gemini_service.py` に、新パラメータを検証するテストケースを追加。 |
| **T-IQ-02** | APIリクエストモデルの拡張 | `backend/src/api/admin.py` の `GenerationRequest` Pydanticモデルを修正し、T-IQ-01で追加したパラメータを定義する。 | `GenerationRequest` モデルが拡張されている。 | - |
| **T-IQ-03** | APIエンドポイントの修正 | `admin.py` の `/admin/generate` エンドポイントを修正。拡張された `GenerationRequest` を受け取り、新しいパラメータを `GeminiService` に渡すように変更する。 | `/admin/generate` が新しいパラメータを処理できる。 | `test_admin.py` に、APIが新パラメータを正しく受け付けるか検証するテストケースを追加。 |

### フェーズ2: フロントエンドUI実装 (担当: Claude, 期間: 2営業日)

**目的:** ユーザーが詳細なパラメータを設定し、画像を生成・確認できるUIを構築する。

| タスクID | タスク名 | 詳細 | 成果物 | テスト |
|:---|:---|:---|:---|:---|
| **T-IQ-04** | APIクライアントの更新 | `frontend/src/services/api.ts` (または同等のファイル) に、拡張された `/admin/generate` APIを呼び出すための関数を修正・追加する。 | API呼び出し関数が新しいパラメータを送信できる。 | - |
| **T-IQ-05** | 画像生成UIコンポーネントの新規作成 | `frontend/src/components/` に `ImageGenerator.tsx` を新規作成。プロンプト入力欄、ネガティブプロンプト入力欄、各種パラメータ選択UI（ドロップダウン、ボタン等）を配置する。 | `ImageGenerator.tsx` ファイル。UIの骨格が実装されている。 | `ImageGenerator.spec.tsx` を作成し、コンポーネントが正しくレンダリングされるかテスト。 |
| **T-IQ-06** | UIロジックの実装 | `ImageGenerator.tsx` に状態管理（`useState`）とイベントハンドラを実装。「生成」ボタンクリックでAPIを呼び出し、ローディング表示、結果画像の表示、エラーメッセージ表示を行うロジックを記述する。 | パラメータ入力と画像生成・表示が一通り動作するUI。 | UIのインタラクション（ボタンクリック、API呼び出しのモック）をテストするケースを追加。 |
| **T-IQ-07** | `App.tsx`への統合 | `App.tsx` を修正し、「設定」画面 (`currentView === 'settings'`) または新設する画面に `ImageGenerator.tsx` コンポーネントを組み込む。 | アプリケーションに画像生成機能が統合されている。 | - |

## 3. 開発スケジュール
- **Day 1:** フェーズ1 (バックエンド機能拡張) の全タスク (T-IQ-01〜03) を完了する。
- **Day 2:** フェーズ2のUIコンポーネント作成とロジック実装 (T-IQ-04〜06) を完了する。
- **Day 3:** フェーズ2の統合と最終テスト (T-IQ-07)、全体の動作確認と微調整を行う。

**合計所要期間: 3営業日**

## 4. リスクと対策
- **リスク:** Google Imagen 2 APIの仕様がドキュメントと異なる、または予期せぬエラーが発生する可能性。
  - **対策:** まずは最小限のパラメータ（例: `quality`）から実装・テストし、段階的に拡張する。APIからのエラーレスポンスを詳細にログ出力する。
- **リスク:** フロントエンドのUIデザインに時間がかかり、スケジュールが遅延する可能性。
  - **対策:** まずは機能性を重視したシンプルなUIを実装する。デザインの凝った作り込みは、基本機能が完成した後の改善タスクとして切り分ける。
