# AIå‹•çš„çµµç”»ã‚·ã‚¹ãƒ†ãƒ  è©³ç´°è¨­è¨ˆæ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: æº–å‹•çš„AIçµµç”»ã‚·ã‚¹ãƒ†ãƒ  (ai-dynamic-painting)  
**æ–‡æ›¸ç¨®åˆ¥**: è©³ç´°è¨­è¨ˆæ›¸  
**ä½œæˆæ—¥**: 2025å¹´9æœˆ9æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

## ğŸ“‹ ç›®æ¬¡
1. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
2. [ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨­è¨ˆ](#ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨­è¨ˆ)
3. [ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆ](#ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆ)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
6. [UI/UXè¨­è¨ˆ](#uiuxè¨­è¨ˆ)
7. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
8. [é‹ç”¨ãƒ»ä¿å®ˆè¨­è¨ˆ](#é‹ç”¨ä¿å®ˆè¨­è¨ˆ)

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆå›³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WiFi     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   M5STACK       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      Raspberry Pi               â”‚
â”‚  ãƒ»ã‚»ãƒ³ã‚µãƒ¼      â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  ãƒ»åˆ¶å¾¡UI       â”‚             â”‚  â”‚     Main Application        â”‚ â”‚
â”‚  ãƒ»çŠ¶æ…‹è¡¨ç¤º     â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚  â”‚FastAPI  â”‚Display      â”‚ â”‚ â”‚
                                â”‚  â”‚  â”‚Server   â”‚Controller   â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  User Devices   â”‚    WiFi     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  ãƒ»ã‚¹ãƒãƒ›       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚  â”‚Video    â”‚AI Prompt    â”‚ â”‚ â”‚
â”‚  ãƒ»PC           â”‚             â”‚  â”‚  â”‚Manager  â”‚Generator    â”‚ â”‚ â”‚
â”‚  ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ   â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                                â”‚  â”‚  â”‚Database â”‚Config       â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚  â”‚Manager  â”‚Manager      â”‚ â”‚ â”‚
â”‚   PC Monitor    â”‚    HDMI     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  ãƒ»24-32inch    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  ãƒ»1080p+       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  ãƒ»ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚ HTTPS
                                               â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   External APIs   â”‚
                                    â”‚  ãƒ»Google VEO API â”‚
                                    â”‚  ãƒ»Weather API    â”‚
                                    â”‚  ãƒ»ãã®ä»–ã‚¯ãƒ©ã‚¦ãƒ‰  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ä»•æ§˜
| é€šä¿¡è·¯ | ãƒ—ãƒ­ãƒˆã‚³ãƒ« | å½¢å¼ | é »åº¦ |
|---|---|---|---|
| M5STACK âŸ· Pi | HTTP/WiFi | JSON | 30ç§’é–“éš” |
| User âŸ· Pi | HTTP/WiFi | HTML/JSON | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ |
| Pi âŸ· VEO API | HTTPS | JSON | æ•°æ™‚é–“é–“éš” |
| Pi âŸ· Monitor | HDMI | æ˜ åƒä¿¡å· | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°
```
ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿åé›† â†’ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†æ â†’ å‹•ç”»é¸æŠ/ç”Ÿæˆåˆ¤å®š â†’ APIå‘¼ã³å‡ºã— â†’ å‹•ç”»ä¿å­˜ â†’ è¡¨ç¤ºæ›´æ–°
     â†‘                    â†“                     â†“               â†“           â†“         â†“
M5STACK â†â† çŠ¶æ…‹é€šçŸ¥ â†â† åˆ¤å®šçµæœ â†â† ç”Ÿæˆã‚­ãƒ¥ãƒ¼ â†â† VEO API â†â† ä¿å­˜å®Œäº† â†â† è¡¨ç¤ºä¸­
```

---

## ğŸ”§ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨­è¨ˆ

### å¿…è¦æ©Ÿå™¨ä»•æ§˜
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ¢ãƒ‡ãƒ«ä¾‹ | ä»•æ§˜ | å½¹å‰² |
|---|---|---|---|
| SBC | Raspberry Pi 4B/5 | 8GB RAM, WiFi, HDMI | ãƒ¡ã‚¤ãƒ³å‡¦ç† |
| åˆ¶å¾¡ãƒ‡ãƒã‚¤ã‚¹ | M5STACK Core/Core2 | WiFi, LCD, ãƒœã‚¿ãƒ³Ã—3 | åˆ¶å¾¡ãƒ»è¡¨ç¤º |
| ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ | æ±ç”¨PCãƒ¢ãƒ‹ã‚¿ãƒ¼ | 24-32inch, 1080p+ | å‹•ç”»è¡¨ç¤º |
| ã‚»ãƒ³ã‚µãƒ¼ | å„ç¨®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | å…‰ãƒ»æ¸©åº¦ãƒ»äººæ„Ÿ | ç’°å¢ƒæ¤œçŸ¥ |

### M5STACKã‚»ãƒ³ã‚µãƒ¼æ§‹æˆ
```cpp
// ã‚»ãƒ³ã‚µãƒ¼ãƒ”ãƒ³é…ç½®
#define LIGHT_SENSOR_PIN    36  // ã‚¢ãƒŠãƒ­ã‚°å…‰ã‚»ãƒ³ã‚µãƒ¼
#define TEMP_SENSOR_PIN     21  // I2Cæ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼
#define PIR_SENSOR_PIN      2   // ãƒ‡ã‚¸ã‚¿ãƒ«äººæ„Ÿã‚»ãƒ³ã‚µãƒ¼
#define BUTTON_A_PIN        39  // å†…è”µãƒœã‚¿ãƒ³A
#define BUTTON_B_PIN        38  // å†…è”µãƒœã‚¿ãƒ³B  
#define BUTTON_C_PIN        37  // å†…è”µãƒœã‚¿ãƒ³C
```

### é…ç·šãƒ»è¨­ç½®è¨­è¨ˆ
```
M5STACKé…ç½®:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤    â”‚
â”‚                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚  â”‚M5STACK  â”‚
â”‚     å‹•ç”»è¡¨ç¤º     â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚                 â”‚  â”‚â”‚ LCD â”‚â”‚  â”‚
â”‚                 â”‚  â”‚â””â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ A B C   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é›»æºãƒ»ã‚±ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
- **Raspberry Pi**: USB-C 5V/3A
- **M5STACK**: USB-C 5V/1A
- **ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤**: ACé›»æºï¼ˆæ©Ÿç¨®ä¾å­˜ï¼‰
- **HDMI**: Raspberry Pi â†’ ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: WiFiï¼ˆæœ‰ç·šLANäºˆå‚™ï¼‰

---

## ğŸ’» ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°
| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|---|---|---|---|
| OS | Raspberry Pi OS | 64-bit | ãƒ™ãƒ¼ã‚¹OS |
| Runtime | Python | 3.11+ | ãƒ¡ã‚¤ãƒ³è¨€èª |
| Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | FastAPI | 0.100+ | REST API |
| DB | SQLite | 3.40+ | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– |
| è¡¨ç¤ºåˆ¶å¾¡ | Pygame | 2.5+ | å‹•ç”»å†ç”Ÿ |
| ç”»åƒå‡¦ç† | OpenCV | 4.8+ | å‹•ç”»å‡¦ç† |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | HTML/CSS/JS | - | Web UI |
| M5STACK | Arduino IDE | - | IoTãƒ‡ãƒã‚¤ã‚¹ |

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
```
ai_painting_system/
â”œâ”€â”€ main.py                 # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py         # è¨­å®šç®¡ç†
â”‚   â””â”€â”€ constants.py        # å®šæ•°å®šç¾©
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ display_controller.py    # è¡¨ç¤ºåˆ¶å¾¡
â”‚   â”œâ”€â”€ video_manager.py         # å‹•ç”»ç®¡ç†
â”‚   â”œâ”€â”€ prompt_generator.py      # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”‚   â””â”€â”€ context_analyzer.py      # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†æ
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ veo_client.py       # VEO APIçµ±åˆ
â”‚   â”œâ”€â”€ weather_client.py   # å¤©æ°—APIçµ±åˆ
â”‚   â””â”€â”€ m5stack_api.py      # M5STACKé€šä¿¡
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ app.py              # FastAPI ã‚¢ãƒ—ãƒª
â”‚   â”œâ”€â”€ routes/             # APIãƒ«ãƒ¼ãƒˆ
â”‚   â””â”€â”€ static/             # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ models.py           # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ database.py         # DBæ“ä½œ
â””â”€â”€ utils/
    â”œâ”€â”€ logger.py           # ãƒ­ã‚°ç®¡ç†
    â””â”€â”€ helpers.py          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

### ä¸»è¦ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

#### DisplayController
```python
class DisplayController:
    """è¡¨ç¤ºåˆ¶å¾¡ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.screen: pygame.Surface
        self.video_player: VideoPlayer
        self.overlay_manager: OverlayManager
        
    def load_video(self, video_path: str) -> bool:
        """å‹•ç”»èª­ã¿è¾¼ã¿"""
        
    def update_display(self) -> None:
        """è¡¨ç¤ºæ›´æ–°ï¼ˆ30fpsï¼‰"""
        
    def show_overlay(self, data: dict) -> None:
        """ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼ˆæ™‚åˆ»ãƒ»å¤©æ°—ç­‰ï¼‰"""
```

#### VideoManager
```python
class VideoManager:
    """å‹•ç”»ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, db: DatabaseManager):
        self.db = db
        self.cache_manager = CacheManager()
        
    def select_best_video(self, context: dict) -> str:
        """æœ€é©å‹•ç”»é¸æŠ"""
        
    def add_video(self, video_path: str, metadata: dict) -> int:
        """å‹•ç”»ç™»éŒ²"""
        
    def cleanup_old_videos(self) -> None:
        """å¤ã„å‹•ç”»å‰Šé™¤"""
```

#### VEOClient
```python
class VEOClient:
    """VEO API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.quota_manager = QuotaManager()
        
    async def generate_video(self, prompt: str) -> dict:
        """å‹•ç”»ç”Ÿæˆ"""
        
    def check_quota(self) -> int:
        """æ®‹ã‚Šã‚¯ã‚©ãƒ¼ã‚¿ç¢ºèª"""
```

### è¨­å®šç®¡ç†è¨­è¨ˆ
```python
# settings.py
class Settings:
    # APIè¨­å®š
    VEO_API_KEY: str = ""
    WEATHER_API_KEY: str = ""
    
    # è¡¨ç¤ºè¨­å®š
    DISPLAY_WIDTH: int = 1920
    DISPLAY_HEIGHT: int = 1080
    FULLSCREEN: bool = True
    
    # ç”Ÿæˆè¨­å®š
    DAILY_GENERATION_LIMIT: int = 3
    VIDEO_CACHE_SIZE_GB: int = 10
    
    # M5STACKè¨­å®š
    M5STACK_IP: str = "192.168.1.100"
    SENSOR_UPDATE_INTERVAL: int = 30
```

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ERãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     videos      â”‚    â”‚   video_tags    â”‚    â”‚      tags       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚    â”‚ video_id (FK)   â”‚    â”‚ id (PK)         â”‚
â”‚ filepath        â”‚    â”‚ tag_id (FK)     â”‚    â”‚ name            â”‚
â”‚ prompt          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ category        â”‚
â”‚ time_period     â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ weather         â”‚
â”‚ season          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ generated_at    â”‚    â”‚   user_prefs    â”‚
â”‚ view_count      â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_rating     â”‚    â”‚ id (PK)         â”‚
â”‚ api_cost        â”‚    â”‚ key             â”‚
â”‚ file_size       â”‚    â”‚ value           â”‚
â”‚ duration        â”‚    â”‚ updated_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ generation_log  â”‚    â”‚  system_status  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚
â”‚ date            â”‚    â”‚ component       â”‚
â”‚ videos_generatedâ”‚    â”‚ status          â”‚
â”‚ total_cost      â”‚    â”‚ last_check      â”‚
â”‚ api_calls       â”‚    â”‚ error_count     â”‚
â”‚ success_rate    â”‚    â”‚ data            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°ä»•æ§˜

#### videos ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE videos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filepath TEXT UNIQUE NOT NULL,
    prompt TEXT NOT NULL,
    time_period TEXT CHECK(time_period IN ('morning', 'daytime', 'evening', 'night')),
    weather TEXT CHECK(weather IN ('sunny', 'cloudy', 'rainy', 'snowy', 'stormy')),
    season TEXT CHECK(season IN ('spring', 'summer', 'autumn', 'winter')),
    mood TEXT,
    style TEXT DEFAULT 'realistic',
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    view_count INTEGER DEFAULT 0,
    user_rating REAL DEFAULT 0.0,
    api_cost REAL DEFAULT 0.0,
    file_size INTEGER DEFAULT 0,
    duration REAL DEFAULT 8.0,
    is_manual_upload BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### user_preferences ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE user_preferences (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key TEXT UNIQUE NOT NULL,
    value TEXT NOT NULL,
    description TEXT,
    category TEXT DEFAULT 'general',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆæœŸè¨­å®šå€¤
INSERT INTO user_preferences (key, value, description, category) VALUES
('display_overlay', 'true', 'ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºè¨­å®š', 'display'),
('auto_generation', 'true', 'è‡ªå‹•ç”Ÿæˆæœ‰åŠ¹åŒ–', 'generation'),
('preferred_time_morning', '06:00', 'æœã®é–‹å§‹æ™‚åˆ»', 'schedule'),
('preferred_time_evening', '18:00', 'å¤•æ–¹ã®é–‹å§‹æ™‚åˆ»', 'schedule');
```

### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤è¨­è¨ˆ
```python
class DatabaseManager:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.init_database()
    
    # å‹•ç”»ç®¡ç†
    def add_video(self, video_data: dict) -> int
    def get_videos_by_context(self, context: dict) -> List[dict]
    def update_video_stats(self, video_id: int, view_count: int = None, rating: float = None)
    def delete_video(self, video_id: int) -> bool
    
    # è¨­å®šç®¡ç†
    def get_preference(self, key: str) -> str
    def set_preference(self, key: str, value: str) -> bool
    def get_all_preferences(self) -> dict
    
    # ãƒ­ã‚°ãƒ»çµ±è¨ˆ
    def log_generation(self, date: str, cost: float, success: bool)
    def get_monthly_stats(self, year_month: str) -> dict
```

---

## ğŸ”Œ APIè¨­è¨ˆ

### REST APIä»•æ§˜

#### åŸºæœ¬æƒ…å ±
- **ãƒ™ãƒ¼ã‚¹URL**: `http://192.168.1.xxx:8080/api/v1`
- **èªè¨¼**: ãªã—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**: JSON
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ + JSON

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†
```
GET    /api/v1/status           # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹å–å¾—
POST   /api/v1/restart          # ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•
GET    /api/v1/logs             # ãƒ­ã‚°å–å¾—
```

#### å‹•ç”»ç®¡ç†
```
GET    /api/v1/videos           # å‹•ç”»ä¸€è¦§å–å¾—
POST   /api/v1/videos           # å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
GET    /api/v1/videos/{id}      # å‹•ç”»è©³ç´°å–å¾—
PUT    /api/v1/videos/{id}      # å‹•ç”»æƒ…å ±æ›´æ–°
DELETE /api/v1/videos/{id}      # å‹•ç”»å‰Šé™¤
POST   /api/v1/videos/generate  # å‹•ç”»ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```

#### è¡¨ç¤ºåˆ¶å¾¡
```
GET    /api/v1/display/current  # ç¾åœ¨è¡¨ç¤ºä¸­å‹•ç”»
POST   /api/v1/display/switch   # å‹•ç”»åˆ‡ã‚Šæ›¿ãˆ
PUT    /api/v1/display/settings # è¡¨ç¤ºè¨­å®šæ›´æ–°
```

#### è¨­å®šç®¡ç†
```
GET    /api/v1/config           # å…¨è¨­å®šå–å¾—
PUT    /api/v1/config           # è¨­å®šæ›´æ–°
GET    /api/v1/config/{key}     # å€‹åˆ¥è¨­å®šå–å¾—
PUT    /api/v1/config/{key}     # å€‹åˆ¥è¨­å®šæ›´æ–°
```

#### M5STACKé€šä¿¡
```
POST   /api/v1/sensors          # ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å—ä¿¡
POST   /api/v1/commands         # ã‚³ãƒãƒ³ãƒ‰å—ä¿¡
GET    /api/v1/m5stack/status   # M5STACKç”¨çŠ¶æ…‹é€ä¿¡
```

### APIè©³ç´°ä»•æ§˜ä¾‹

#### GET /api/v1/videos
```json
{
  "videos": [
    {
      "id": 1,
      "filepath": "/cache/video_001.mp4",
      "prompt": "Cherry blossoms in morning sunlight",
      "time_period": "morning",
      "weather": "sunny",
      "season": "spring",
      "generated_at": "2025-09-09T08:00:00Z",
      "view_count": 5,
      "user_rating": 4.5,
      "duration": 8.0
    }
  ],
  "total": 45,
  "page": 1,
  "per_page": 20
}
```

#### POST /api/v1/videos/generate
```json
// Request
{
  "context": {
    "time_period": "evening",
    "weather": "rainy",
    "season": "autumn"
  },
  "priority": "high",
  "custom_prompt": "Cozy fireplace scene"
}

// Response
{
  "generation_id": "gen_12345",
  "status": "queued",
  "estimated_time": 300,
  "quota_remaining": 87
}
```

### VEO APIçµ±åˆä»•æ§˜
```python
class VEOAPIWrapper:
    async def generate_video(self, prompt: str, config: dict) -> dict:
        """
        VEO APIå‘¼ã³å‡ºã—ãƒ©ãƒƒãƒ‘ãƒ¼
        
        Args:
            prompt: ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            config: ç”Ÿæˆè¨­å®š
            
        Returns:
            {
                "success": bool,
                "video_url": str,
                "generation_time": float,
                "cost": float,
                "error": str
            }
        """
```

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### Webè¨­å®šç”»é¢è¨­è¨ˆ

#### ç”»é¢æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Dynamic Painting - Control Panel                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Dashboard] [Videos] [Generation] [Settings] [Logs]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ç¾åœ¨ã®çŠ¶æ…‹                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹  â”‚ â”‚å‹•ç”»å†ç”Ÿä¸­    â”‚ â”‚æœˆé–“ä½¿ç”¨é‡    â”‚        â”‚
â”‚  â”‚   ğŸŸ¢ æ­£å¸¸   â”‚ â”‚Evening Rain â”‚ â”‚  45/90      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚  ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                                       â”‚
â”‚  [æ¬¡ã®å‹•ç”»] [ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ] [å†èµ·å‹•] [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹]       â”‚
â”‚                                                         â”‚
â”‚  æœ€è¿‘ã®å‹•ç”» (5ä»¶)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ¬ Morning_Forest.mp4    [â–¶] [â­] [ğŸ—‘]              â”‚ â”‚
â”‚  â”‚ ğŸ¬ Evening_Rain.mp4      [â–¶] [â­] [ğŸ—‘]              â”‚ â”‚
â”‚  â”‚ ğŸ¬ Night_Stars.mp4       [â–¶] [â­] [ğŸ—‘]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‹•ç”»ç®¡ç†ç”»é¢
```
å‹•ç”»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Filter: [All] [Generated] [Uploaded] [Favorites]    â”‚
â”‚ ğŸ” Search: [                     ] [Search]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚[Thumb]  â”‚ â”‚[Thumb]  â”‚ â”‚[Thumb]  â”‚ â”‚[Thumb]  â”‚        â”‚
â”‚ â”‚Morning  â”‚ â”‚Evening  â”‚ â”‚Night    â”‚ â”‚Rainy    â”‚        â”‚
â”‚ â”‚Sunny    â”‚ â”‚Cloudy   â”‚ â”‚Clear    â”‚ â”‚Day      â”‚        â”‚
â”‚ â”‚â­â­â­â­  â”‚ â”‚â­â­â­   â”‚ â”‚â­â­â­â­â­â”‚ â”‚â­â­     â”‚        â”‚
â”‚ â”‚Views:12 â”‚ â”‚Views:8  â”‚ â”‚Views:15 â”‚ â”‚Views:3  â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚ [+ Upload Video] [ğŸ¬ Generate New] [âš™ Batch Actions]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¨­å®šç”»é¢
```
ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨ç¤ºè¨­å®š                                                â”‚
â”‚ â˜‘ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º (æ™‚åˆ»ãƒ»å¤©æ°—)                          â”‚
â”‚ â˜‘ è‡ªå‹•æ˜åº¦èª¿æ•´                                          â”‚
â”‚ Brightness: [â—â”€â”€â”€â”€â”€â”€â”€â”€] 70%                            â”‚
â”‚                                                         â”‚
â”‚ ç”Ÿæˆè¨­å®š                                                â”‚
â”‚ â˜‘ è‡ªå‹•ç”Ÿæˆæœ‰åŠ¹                                          â”‚
â”‚ Daily Limit: [3] videos                                â”‚
â”‚ Quality: [â—] High [â—‹] Medium [â—‹] Fast                  â”‚
â”‚                                                         â”‚
â”‚ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«                                             â”‚
â”‚ Morning: [06:00] - [10:00]                             â”‚
â”‚ Evening: [18:00] - [22:00]                             â”‚
â”‚ â˜‘ Weekend special generation                           â”‚
â”‚                                                         â”‚
â”‚ APIè¨­å®š                                                 â”‚
â”‚ VEO API Key: [â—â—â—â—â—â—â—â—â—â—â—â—] [Test Connection]         â”‚
â”‚ Weather API Key: [â—â—â—â—â—â—â—â—â—â—â—â—] [Test Connection]     â”‚
â”‚                                                         â”‚
â”‚ [Save Settings] [Reset to Defaults] [Export Config]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### M5STACK UIè¨­è¨ˆ

#### ãƒ¡ã‚¤ãƒ³ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Painting     â”‚
â”‚ ğŸŒ… Morning/Sunnyâ”‚  <- æ™‚é–“å¸¯/å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³
â”‚ ğŸ“¹ Video: 3/12  â”‚  <- ç¾åœ¨å‹•ç”»/ç·æ•°
â”‚ ğŸ’¡ Light: 65%   â”‚  <- å…‰ã‚»ãƒ³ã‚µãƒ¼å€¤
â”‚ ğŸŒ¡ï¸ Temp: 23Â°C   â”‚  <- æ¸©åº¦
â”‚ WiFi: â—â—â—â—‹     â”‚  <- WiFiä¿¡å·å¼·åº¦
â”‚                 â”‚
â”‚ A:Next B:â¤ C:âš™ â”‚  <- ãƒœã‚¿ãƒ³æ©Ÿèƒ½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Settings      â”‚
â”‚                 â”‚
â”‚ > Display       â”‚  <- ãƒœã‚¿ãƒ³Aã§é¸æŠ
â”‚   Generation    â”‚
â”‚   Network       â”‚
â”‚   System        â”‚
â”‚                 â”‚
â”‚ A:Select B:Back â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­è¨ˆ
- **ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³**: ç¸¦ç”»é¢æœ€é©åŒ–ã€ã‚¿ãƒƒãƒæ“ä½œ
- **ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ**: æ¨ªç”»é¢ã€è©³ç´°è¡¨ç¤º
- **PC**: ãƒ•ãƒ«æ©Ÿèƒ½ã€ãƒãƒ«ãƒã‚«ãƒ©ãƒ 

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„…å¨åˆ†æ
| è„…å¨ | ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ« | å¯¾ç­– |
|---|---|---|
| ä¸æ­£ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ | ä¸­ | ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™ |
| API ã‚­ãƒ¼æ¼æ´© | é«˜ | ç’°å¢ƒå¤‰æ•°ãƒ»æš—å·åŒ–ä¿å­˜ |
| å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“ | ä½ | ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ |
| DoSæ”»æ’ƒ | ä½ | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ»ç›£è¦– |

### å®Ÿè£…ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
```python
# FastAPI ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
from fastapi import FastAPI, Depends, HTTPException
from fastapi.middleware.cors import CORSMiddleware
import ipaddress

app = FastAPI()

# CORSè¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã¿ï¼‰
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://192.168.1.*", "http://localhost:*"],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)

# IPåˆ¶é™ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
@app.middleware("http")
async def limit_local_network(request: Request, call_next):
    client_ip = request.client.host
    
    # ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒã‚§ãƒƒã‚¯
    if not (ipaddress.ip_address(client_ip).is_private or 
            client_ip == "127.0.0.1"):
        raise HTTPException(status_code=403, detail="Access denied")
    
    response = await call_next(request)
    return response
```

#### ãƒ‡ãƒ¼ã‚¿ä¿è­·
```python
# API ã‚­ãƒ¼æš—å·åŒ–ä¿å­˜
from cryptography.fernet import Fernet
import os

class SecureConfig:
    def __init__(self):
        self.key = self._get_or_create_key()
        self.cipher = Fernet(self.key)
    
    def _get_or_create_key(self) -> bytes:
        key_file = "/home/pi/.painting_key"
        if os.path.exists(key_file):
            with open(key_file, 'rb') as f:
                return f.read()
        else:
            key = Fernet.generate_key()
            with open(key_file, 'wb') as f:
                f.write(key)
            os.chmod(key_file, 0o600)  # æ‰€æœ‰è€…ã®ã¿èª­ã¿å–ã‚Šå¯èƒ½
            return key
    
    def store_api_key(self, service: str, api_key: str):
        encrypted = self.cipher.encrypt(api_key.encode())
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æš—å·åŒ–ã•ã‚ŒãŸã‚­ãƒ¼ã‚’ä¿å­˜
        
    def get_api_key(self, service: str) -> str:
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æš—å·åŒ–ã•ã‚ŒãŸã‚­ãƒ¼ã‚’å–å¾—ãƒ»å¾©å·
        pass
```

#### ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§
```python
import hashlib

class FileIntegrityManager:
    def calculate_checksum(self, filepath: str) -> str:
        sha256_hash = hashlib.sha256()
        with open(filepath, "rb") as f:
            for chunk in iter(lambda: f.read(4096), b""):
                sha256_hash.update(chunk)
        return sha256_hash.hexdigest()
    
    def verify_video_integrity(self, video_id: int) -> bool:
        video_data = self.db.get_video(video_id)
        current_checksum = self.calculate_checksum(video_data['filepath'])
        return current_checksum == video_data.get('checksum', '')
```

### é‹ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: é‡è¦ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- **ãƒ­ã‚°ç›£è¦–**: ç•°å¸¸ã‚¢ã‚¯ã‚»ã‚¹ã®æ¤œå‡ºãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- **ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç®¡ç†**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®å®šæœŸé©ç”¨
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: SSHéµèªè¨¼ã€sudoåˆ¶é™

---

## ğŸ”§ é‹ç”¨ãƒ»ä¿å®ˆè¨­è¨ˆ

### ç›£è¦–ãƒ»ãƒ­ã‚°è¨­è¨ˆ

#### ãƒ­ã‚°åˆ†é¡
| ãƒ­ã‚°ç¨®åˆ¥ | ãƒ•ã‚¡ã‚¤ãƒ« | ä¿å­˜æœŸé–“ | ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ |
|---|---|---|---|
| ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | app.log | 30æ—¥ | æ—¥æ¬¡ |
| API ã‚¢ã‚¯ã‚»ã‚¹ | api.log | 7æ—¥ | æ—¥æ¬¡ |
| ã‚·ã‚¹ãƒ†ãƒ  | system.log | 30æ—¥ | é€±æ¬¡ |
| ã‚¨ãƒ©ãƒ¼ | error.log | 90æ—¥ | é€±æ¬¡ |

#### ãƒ­ã‚°å½¢å¼
```python
import logging
from datetime import datetime

# çµ±ä¸€ãƒ­ã‚°å½¢å¼
LOG_FORMAT = "%(asctime)s [%(levelname)s] %(name)s: %(message)s"

# æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONï¼‰
{
    "timestamp": "2025-09-09T12:00:00Z",
    "level": "INFO",
    "component": "video_manager",
    "action": "video_generated",
    "data": {
        "video_id": 123,
        "prompt": "morning landscape",
        "generation_time": 180.5,
        "api_cost": 0.75
    }
}
```

### è‡ªå‹•ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
```python
class SystemMonitor:
    def __init__(self):
        self.checks = [
            self.check_disk_space,
            self.check_memory_usage,
            self.check_api_connectivity,
            self.check_video_playback,
            self.check_m5stack_connection
        ]
    
    async def run_health_checks(self) -> dict:
        results = {}
        for check in self.checks:
            try:
                results[check.__name__] = await check()
            except Exception as e:
                results[check.__name__] = {"status": "error", "error": str(e)}
        
        return results
    
    async def check_disk_space(self) -> dict:
        import shutil
        total, used, free = shutil.disk_usage("/")
        usage_percent = (used / total) * 100
        
        return {
            "status": "warning" if usage_percent > 80 else "ok",
            "usage_percent": usage_percent,
            "free_gb": free // (1024**3)
        }
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥
```python
class BackupManager:
    def __init__(self):
        self.backup_targets = [
            "/home/pi/ai_painting_system/database/",
            "/home/pi/ai_painting_system/config/",
            "/home/pi/ai_painting_system/logs/"
        ]
    
    def create_backup(self, backup_type: str = "daily"):
        """
        ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¨®åˆ¥:
        - daily: è¨­å®šãƒ»DBãƒ»ãƒ­ã‚°
        - weekly: ä¸Šè¨˜ + å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé¸æŠï¼‰
        - manual: å…¨ãƒ•ã‚¡ã‚¤ãƒ«
        """
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_path = f"/home/pi/backups/{backup_type}_{timestamp}"
        
        # å®Ÿè£…è©³ç´°
        pass
```

### ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç®¡ç†
```python
class UpdateManager:
    def check_updates(self) -> dict:
        """
        ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèª:
        - ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
        - Pythonä¾å­˜é–¢ä¿‚
        - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
        """
        pass
    
    def apply_updates(self, update_type: str):
        """
        å®‰å…¨ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé©ç”¨:
        1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
        2. ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé©ç”¨
        3. æ•´åˆæ€§ç¢ºèª
        4. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æº–å‚™
        """
        pass
```

### éšœå®³å¯¾å¿œæ‰‹é †

#### è‡ªå‹•å¾©æ—§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
1. **è»½å¾®ãªéšœå®³**: è‡ªå‹•å†è©¦è¡Œï¼ˆ3å›ã¾ã§ï¼‰
2. **ä¸­ç¨‹åº¦ã®éšœå®³**: ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
3. **é‡å¤§ãªéšœå®³**: ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰ç§»è¡Œ

#### æ‰‹å‹•å¯¾å¿œæ‰‹é †æ›¸
```bash
# ç·Šæ€¥æ™‚å¯¾å¿œã‚³ãƒãƒ³ãƒ‰é›†
# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
sudo systemctl status ai-painting

# ãƒ­ã‚°ç¢ºèª
tail -f /home/pi/ai_painting_system/logs/error.log

# å®‰å…¨ãªå†èµ·å‹•
sudo systemctl restart ai-painting

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
sudo systemctl stop ai-painting
sudo rm -rf /tmp/ai_painting_cache/*
sudo systemctl start ai-painting
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–
```python
class PerformanceMonitor:
    def get_system_stats(self) -> dict:
        import psutil
        
        return {
            "cpu_percent": psutil.cpu_percent(interval=1),
            "memory_percent": psutil.virtual_memory().percent,
            "disk_io": psutil.disk_io_counters(),
            "network_io": psutil.net_io_counters(),
            "temperature": self.get_cpu_temperature()
        }
    
    def get_cpu_temperature(self) -> float:
        # Raspberry Pi CPUæ¸©åº¦å–å¾—
        try:
            with open('/sys/class/thermal/thermal_zone0/temp', 'r') as f:
                temp = int(f.read()) / 1000.0
            return temp
        except:
            return 0.0
```

#### æœ€é©åŒ–è¨­å®š
```python
# Raspberry Pi æœ€é©åŒ–è¨­å®š
OPTIMIZATION_CONFIG = {
    # ãƒ¡ãƒ¢ãƒªè¨­å®š
    "gpu_mem": 128,  # GPU ãƒ¡ãƒ¢ãƒªåˆ†å‰²
    "swap_size": 2048,  # ã‚¹ãƒ¯ãƒƒãƒ—ã‚µã‚¤ã‚º (MB)
    
    # CPUè¨­å®š
    "cpu_governor": "ondemand",  # CPU ã‚¬ãƒãƒŠãƒ¼
    "cpu_freq_max": 1800,  # æœ€å¤§å‘¨æ³¢æ•° (MHz)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–
    "mount_options": "noatime,nodiratime",
    
    # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœ€é©åŒ–
    "tcp_congestion": "bbr",
    "net_buffer_size": 65536
}
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### æƒ³å®šè² è·ãƒ»æ€§èƒ½è¦ä»¶
| é …ç›® | è¦ä»¶ | ç›®æ¨™å€¤ |
|---|---|---|
| å‹•ç”»åˆ‡ã‚Šæ›¿ãˆå¿œç­”æ™‚é–“ | 3ç§’ä»¥å†… | 1ç§’ä»¥å†… |
| Web UIå¿œç­”æ™‚é–“ | 5ç§’ä»¥å†… | 2ç§’ä»¥å†… |
| ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡ | 95%ä»¥ä¸Š | 99%ä»¥ä¸Š |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ | 80%ä»¥ä¸‹ | 60%ä»¥ä¸‹ |
| CPUä½¿ç”¨ç‡ï¼ˆå¹³æ™‚ï¼‰ | 30%ä»¥ä¸‹ | 20%ä»¥ä¸‹ |

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£è¨­è¨ˆ
```python
# å°†æ¥çš„ãªæ‹¡å¼µå¯¾å¿œ
class ScalabilityManager:
    def __init__(self):
        self.load_balancer = None  # å°†æ¥å®Ÿè£…
        self.cache_cluster = None  # åˆ†æ•£ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        
    def add_display_node(self, node_config: dict):
        """è¿½åŠ ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãƒãƒ¼ãƒ‰å¯¾å¿œ"""
        pass
    
    def setup_content_distribution(self):
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡æœ€é©åŒ–"""
        pass
```

---

## ğŸ”„ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»éšœå®³å¯¾å¿œ

### ã‚¨ãƒ©ãƒ¼åˆ†é¡ãƒ»å¯¾å¿œãƒãƒˆãƒªãƒƒã‚¯ã‚¹
| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | é‡è¦åº¦ | è‡ªå‹•å¯¾å¿œ | é€šçŸ¥ | æ‰‹å‹•å¯¾å¿œ |
|---|---|---|---|---|
| VEO API ã‚¨ãƒ©ãƒ¼ | é«˜ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ç”» | âœ“ | APIç¢ºèª |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ | ä¸­ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ç”» | âœ“ | æ¥ç¶šç¢ºèª |
| å‹•ç”»å†ç”Ÿã‚¨ãƒ©ãƒ¼ | ä¸­ | æ¬¡å‹•ç”»ã«ã‚¹ã‚­ãƒƒãƒ— | âœ“ | ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª |
| M5STACKé€šä¿¡ã‚¨ãƒ©ãƒ¼ | ä½ | å†æ¥ç¶šè©¦è¡Œ | - | ç‰©ç†ç¢ºèª |
| ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³ | é«˜ | å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ | âœ“ | å®¹é‡ç¢ºä¿ |

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
```python
class ErrorHandler:
    def __init__(self):
        self.retry_config = {
            "max_retries": 3,
            "backoff_factor": 2,
            "timeout": 30
        }
    
    async def handle_api_error(self, error: Exception, context: dict):
        if isinstance(error, APIQuotaExceeded):
            # ã‚¯ã‚©ãƒ¼ã‚¿è¶…éæ™‚ã®å¯¾å¿œ
            await self.switch_to_cached_content()
            await self.schedule_retry_tomorrow()
            
        elif isinstance(error, NetworkError):
            # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾å¿œ
            await self.retry_with_backoff()
            
        else:
            # ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
            await self.log_error_and_continue(error, context)
    
    async def failsafe_mode(self):
        """ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰ï¼ˆæœ€ä½é™ã®æ©Ÿèƒ½ã§ç¶™ç¶šï¼‰"""
        # åŸºæœ¬çš„ãªé™çš„ç”»åƒè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
        await self.display_controller.load_fallback_content()
        
        # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã‚’ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®š
        await self.system_status.set_mode("failsafe")
        
        # å®šæœŸçš„ãªå¾©æ—§è©¦è¡Œã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        await self.schedule_recovery_attempts()
```

---
